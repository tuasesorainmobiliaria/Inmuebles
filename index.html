<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inmuebles Maribel | Catálogo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .gradiente-maribel { background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%); }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">

    <header class="gradiente-maribel text-white py-12 px-4 shadow-2xl text-center">
        <h1 class="text-4xl md:text-5xl font-black tracking-tighter uppercase">Inmuebles Maribel</h1>
        <p class="mt-3 text-blue-100 text-xl font-light italic">"Transformo tu sueño en una realidad"</p>
    </header>

    <main id="contenedor-casas" class="max-w-7xl mx-auto p-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        <div class="col-span-full text-center py-20">
            <p id="mensaje-estado" class="text-gray-500 font-medium italic">Conectando con el inventario de Maribel...</p>
        </div>
    </main>

    <script>
        // ID de tu Excel corregido
        const EXCEL_ID = '16dqDFvIQO9fPykDBD6PIWhf6_Sure1Q2_7yJtslTHZM';
        const WHATSAPP = '584127085935'; 

        async function cargarCasas() {
            const contenedor = document.getElementById('contenedor-casas');
            const mensaje = document.getElementById('mensaje-estado');

            try {
                // Intentamos obtener los datos
                const response = await fetch(`https://docs.google.com/spreadsheets/d/${EXCEL_ID}/gviz/tq?tqx=out:json`);
                const text = await response.text();
                
                // Limpiamos el JSON de Google
                const jsonText = text.substring(47).slice(0, -2);
                const data = JSON.parse(jsonText);
                const filas = data.table.rows;

                if (filas.length <= 1) {
                    mensaje.innerText = "El Excel está conectado, pero no hay propiedades registradas debajo de los títulos.";
                    return;
                }

                contenedor.innerHTML = ''; // Limpiamos para mostrar las casas

                filas.forEach((fila, index) => {
                    if (index === 0) return; // Saltamos los títulos

                    // Extraemos los datos de forma segura
                    const titulo = fila.c[0]?.v || "Sin título";
                    const precio = fila.c[1]?.v || "Consultar";
                    const descripcion = fila.c[2]?.v || "";
                    const fotosRaw = fila.c[3]?.v || "";
                    const fotos = String(fotosRaw).split(',').map(f => f.trim());
                    const fotoPrincipal = fotos[0] || 'https://via.placeholder.com/400x300?text=Sin+Imagen';

                    contenedor.innerHTML += `
                        <div class="bg-white rounded-3xl shadow-lg overflow-hidden border border-gray-100 flex flex-col">
                            <img src="${fotoPrincipal}" class="w-full h-64 object-cover">
                            <div class="p-6 flex-grow">
                                <h2 class="text-2xl font-bold text-gray-800">${titulo}</h2>
                                <p class="text-blue-600 font-black text-2xl mt-2">${precio}</p>
                                <p class="text-gray-500 mt-4 text-sm">${descripcion}</p>
                            </div>
                            <div class="p-6">
                                <a href="https://wa.me/${WHATSAPP}?text=Hola Maribel, me interesa: ${titulo}" 
                                   class="block w-full text-center bg-green-500 text-white font-bold py-3 rounded-xl shadow-lg">
                                   Consultar por WhatsApp
                                </a>
                            </div>
                        </div>
                    `;
                });

            } catch (error) {
                console.error(error);
                mensaje.innerHTML = `
                    <div class="bg-red-50 p-6 rounded-2xl border border-red-200">
                        <p class="text-red-600 font-bold">¡Hay un problema de conexión!</p>
                        <p class="text-red-500 text-sm mt-2">Asegúrate de haber ido a <b>Archivo > Compartir > Publicar en la web</b> en tu Excel.</p>
                    </div>
                `;
            }
        }

        cargarCasas();
    </script>
</body>
</html>
